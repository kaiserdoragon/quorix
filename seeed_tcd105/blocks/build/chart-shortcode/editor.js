!function(){"use strict";var e=window.wp.element,t=window.wp.blocks,r=window.wp.i18n,c=window.wp.blockEditor,a=window.wp.components,l=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"tcd/chart-shortcode","version":"1.0.2","title":"Chart","textdomain":"tcd-seeed","icon":"chart-pie","category":"tcd","attributes":{"chart_id":{"type":"number","default":0},"forcePreviewUrl":{"type":"string","default":""}},"supports":{"anchor":true,"html":false},"editorScript":"file:editor.js"}');const o=(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 20 20",role:"img","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M10 10V3c3.87 0 7 3.13 7 7h-7zM9 4v7h7c0 3.87-3.13 7-7 7s-7-3.13-7-7 3.13-7 7-7z"}));(0,t.registerBlockType)(l,{title:(0,r.__)("Chart","tcd-seeed"),description:(0,r.__)("Add a block that displays the chart.","tcd-seeed"),icon:{src:o},example:{attributes:{chart_id:0,forcePreviewUrl:TcdEditorChart.block_example_preview_url}},edit:t=>{const{attributes:l,setAttributes:i}=t,s=(0,e.useRef)(),[n,d]=(0,e.useState)(l.chart_id),[h,u]=(0,e.useState)(null),[p,m]=(0,e.useState)(!l.chart_id&&!l.forcePreviewUrl),[w,_]=(0,e.useState)(null),[v,b]=(0,e.useState)(null),f=(0,c.useBlockProps)();let E=null;return l.forcePreviewUrl?E=l.forcePreviewUrl:l.chart_id>0&&(E=TcdEditorChart.block_preview_url.replace(/%ID%/,l.chart_id)),(0,e.useEffect)((()=>{if(!l.forcePreviewUrl&&!v&&window.Choices&&s.current){const e=new Choices(s.current,{maxItemCount:100,searchResultLimit:100,searchFields:["label"],shouldSort:!1,placeholder:!0,placeholderValue:TcdEditorChart.choices.placeholderValue,searchPlaceholderValue:TcdEditorChart.choices.searchPlaceholderValue,loadingText:TcdEditorChart.choices.loadingText,noResultsText:TcdEditorChart.choices.noResultsText,itemSelectText:""});e.setChoices((()=>{const r=new FormData;return r.append("action","tcd-get-chart-list"),fetch(ajaxurl,{method:"POST",body:r}).then((e=>e.json())).then((r=>(r.forEach((e=>{e.value==l.chart_id&&(e.selected=!0)})),t.isSelected&&e.showDropdown(),r)))})),_(e)}}),[]),(0,e.createElement)("div",f,(0,e.createElement)(a.Placeholder,{icon:o,label:(0,r.__)("Chart","tcd-seeed"),className:"wp-block-embed",style:p?{}:{display:"none"}},(0,e.createElement)("form",{onSubmit:e=>{e.preventDefault(),n&&n>0&&(i({chart_id:n}),m(!1))}},(0,e.createElement)("select",{className:"components-placeholder__input",ref:s,onChange:e=>d(parseInt(e.target.value,10))}),(0,e.createElement)(a.Button,{variant:"primary",type:"submit"},(0,r.__)("Embed","tcd-seeed")),l.chart_id>0&&(0,e.createElement)(a.Button,{variant:"secondary",type:"button",onClick:e=>m(!1)},(0,r.__)("Cancel","tcd-seeed")))),!p&&E&&(0,e.createElement)("iframe",{className:"tcd-block-chart-preview",src:E,scrolling:"no",frameBorder:"0",onLoad:e=>{e.target.style.height=e.target.contentWindow.document.body.scrollHeight+1+"px"}}),!p&&(0,e.createElement)(c.BlockControls,null,(0,e.createElement)(a.ToolbarGroup,null,(0,e.createElement)(a.ToolbarButton,{label:(0,r.__)("Select chart","tcd-seeed"),icon:(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",role:"img","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M20.1 5.1L16.9 2 6.2 12.7l-1.3 4.4 4.5-1.3L20.1 5.1zM4 20.8h8v-1.5H4v1.5z"})),onClick:()=>m(!0)}))))},save:t=>{const{attributes:r}=t,a=c.useBlockProps.save();return(0,e.createElement)("div",a,'[tcd_chart id="',r.chart_id>0?r.chart_id:null,'"]')}})}();